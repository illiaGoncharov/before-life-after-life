# Настройка Cloudinary для загрузки изображений

## Что это дает

Cloudinary позволяет безопасно загружать и хранить изображения пользователей:
- ✅ **Бесплатный тариф**: 25GB хранилища, 25GB трафика в месяц
- ✅ **Автоматическая оптимизация**: изображения автоматически оптимизируются
- ✅ **CDN**: быстрая загрузка изображений по всему миру
- ✅ **Безопасность**: загрузка через API с защитой от злоупотреблений
- ✅ **Масштабируемость**: легко расширяется при росте проекта

## Как это работает

1. **Пользователь загружает изображения** → файлы сохраняются локально в браузере
2. **При отправке формы** → изображения загружаются в Cloudinary
3. **Cloudinary возвращает ссылки** → ссылки отправляются в EmailJS вместе с данными формы
4. **Вы получаете email** → со ссылками на все загруженные изображения

## Настройка Cloudinary

### Шаг 1: Регистрация

1. Зарегистрируйтесь на [Cloudinary.com](https://cloudinary.com/)
2. Выберите бесплатный тариф (Free Plan)
3. После регистрации вы попадете в Dashboard

### Шаг 2: Получение Cloud Name

1. В Dashboard найдите **Cloud Name** (например, `dxyz123abc`)
2. Это ваш уникальный идентификатор аккаунта

### Шаг 3: Настройка Upload Preset (для unsigned uploads)

Для безопасности рекомендуется использовать **unsigned uploads** с preset:

1. Перейдите в **Settings** → **Upload**
2. Прокрутите до раздела **Upload presets**
3. Нажмите **Add upload preset**
4. Настройте:
   - **Preset name**: `before-life-after-life` (или любое другое имя)
   - **Signing mode**: `Unsigned` (чтобы не использовать API Secret на клиенте)
   - **Folder**: `before-life-after-life` (опционально, для организации файлов)
   - **Use filename**: `Use original filename` или `Unique filename`
5. Сохраните preset

### Шаг 4: Настройка переменных окружения

Для локальной разработки создайте файл `.env` в корне проекта:

```env
REACT_APP_CLOUDINARY_CLOUD_NAME=your_cloud_name
REACT_APP_CLOUDINARY_UPLOAD_PRESET=before-life-after-life
```

⚠️ **Важно**: Не коммитьте `.env` файл в git! Убедитесь, что он в `.gitignore`.

### Шаг 5: Настройка для GitHub Pages

Для GitHub Pages нужно настроить переменные окружения в GitHub Secrets:

1. Перейдите в Settings → Secrets and variables → Actions
2. Добавьте секреты:
   - `REACT_APP_CLOUDINARY_CLOUD_NAME` - ваш Cloud Name
   - `REACT_APP_CLOUDINARY_UPLOAD_PRESET` - имя вашего upload preset

3. Обновите GitHub Actions workflow (`.github/workflows/deploy.yml`), чтобы использовать эти секреты:

```yaml
env:
  REACT_APP_CLOUDINARY_CLOUD_NAME: ${{ secrets.REACT_APP_CLOUDINARY_CLOUD_NAME }}
  REACT_APP_CLOUDINARY_UPLOAD_PRESET: ${{ secrets.REACT_APP_CLOUDINARY_UPLOAD_PRESET }}
```

## Безопасность

### Unsigned Uploads (рекомендуется)

- ✅ Безопасно для клиентской загрузки
- ✅ Не требует API Secret в коде
- ✅ Можно ограничить размер файлов и типы в настройках preset
- ⚠️ Рекомендуется настроить ограничения в preset:
  - Максимальный размер файла: например, 10MB
  - Разрешенные форматы: `jpg`, `png`, `gif`, `webp`
  - Максимальное количество файлов: можно ограничить на уровне приложения

### Signed Uploads (альтернатива)

Если нужна дополнительная безопасность, можно использовать signed uploads:
- Требует API Secret (но его можно хранить на сервере)
- Более строгий контроль доступа
- Для статического хостинга (GitHub Pages) это сложнее настроить

## Ограничения бесплатного тарифа

- **Хранилище**: 25GB
- **Трафик**: 25GB в месяц
- **Трансформации**: 25,000 в месяц
- **Загрузки**: неограниченно

Для большинства проектов этого достаточно. При превышении лимитов можно:
- Оптимизировать изображения перед загрузкой
- Использовать сжатие на стороне Cloudinary
- Перейти на платный тариф при необходимости

## Тестирование

После настройки протестируйте загрузку:

1. Запустите проект локально: `npm start`
2. Заполните форму и загрузите несколько изображений
3. Отправьте форму
4. Проверьте:
   - В консоли браузера не должно быть ошибок
   - В email должны прийти ссылки на Cloudinary
   - Ссылки должны открываться и показывать изображения

## Troubleshooting

### Ошибка: "Cloudinary не настроен"

- Проверьте, что переменные окружения установлены
- Убедитесь, что `.env` файл в корне проекта
- Перезапустите dev server после изменения `.env`

### Ошибка: "Upload preset not found"

- Проверьте имя preset в Cloudinary Dashboard
- Убедитесь, что preset настроен как "Unsigned"
- Проверьте, что имя preset совпадает с переменной окружения

### Ошибка: "File too large"

- Настройте ограничение размера файла в upload preset
- Или добавьте валидацию размера файла перед загрузкой

### Изображения не загружаются

- Проверьте консоль браузера на ошибки
- Убедитесь, что Cloud Name правильный
- Проверьте настройки CORS в Cloudinary (должны быть разрешены для вашего домена)

## Дополнительные возможности

Cloudinary предоставляет множество возможностей:

- **Автоматическое преобразование**: изменение размера, обрезка, фильтры
- **Оптимизация**: автоматическое сжатие и конвертация в WebP
- **CDN**: быстрая доставка изображений по всему миру
- **Аналитика**: статистика использования и трафика

Подробнее: [Cloudinary Documentation](https://cloudinary.com/documentation)

---

Последнее обновление: 2025-01-XX

