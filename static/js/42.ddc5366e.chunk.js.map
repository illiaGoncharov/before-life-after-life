{"version":3,"file":"static/js/42.ddc5366e.chunk.js","mappings":"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","sources":["components/Text/Text.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport \"./Text.css\";\nimport { prompts } from \"../../data/prompts\";\nimport Loader from \"../Loader/Loader\";\n\n// Define a direct mapping from prompt text to audio number\nconst AUDIO_MAPPING = {\n  \"before life\": 1,\n  \"home\": 2,\n  \"family at home\": 3,\n  \"birth\": 4,\n  \"unintended child\": 5,\n  \"puberty\": 6,\n  \"bullied teen\": 7,\n  \"love\": 8,\n  \"love between men\": 9,\n  \"love between women\": 10,\n  \"sex\": 11,\n  \"unsafe sex\": 12,\n  \"healthy person\": 13,\n  \"sick person\": 14,\n  \"person with mental health condition\": 15,\n  \"person with substance use disorder\": 16,\n  \"immigrant\": 17,\n  \"apolitical person\": 18,\n  \"propaganda\": 19,\n  \"people at protest\": 20,\n  \"rich politician\": 21,\n  \"poor politician\": 22,\n  \"poor person\": 23,\n  \"homeless person\": 24,\n  \"unemployed person\": 25,\n  \"influencer\": 26,\n  \"artist\": 27,\n  \"office worker\": 28,\n  \"city\": 29,\n  \"city celebration\": 30,\n  \"city at war\": 31,\n  \"person at war\": 32,\n  \"woman at war\": 33,\n  \"women military parade\": 34,\n  \"tampon in blood\": 35,\n  \"bullet in blood\": 36,\n  \"elderly person\": 37,\n  \"dying person\": 38,\n  \"euthanasia\": 39,\n  \"dying pet\": 40,\n  \"death\": 41,\n  \"funeral\": 42,\n  \"cemetery\": 43,\n  \"religion\": 44,\n  \"afterlife\": 45\n};\n\nfunction Text({ cameraOn = true, soundOn = true, toggleCamera, toggleSound }) {\n  const [offset, setOffset] = useState(window.innerHeight);\n  const SCROLL_SPEED = 0.3;\n  const [currentPromptInCenter, setCurrentPromptInCenter] = useState(null);\n  const [isAudioPlaying, setIsAudioPlaying] = useState(false);\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [audioDisabled, setAudioDisabled] = useState(false);\n  const audioRef = useRef(null);\n  const videoRef = useRef(null);\n  const animationRef = useRef(null);\n  const textWrapperRef = useRef(null);\n  const audioErrorCount = useRef(0);\n  const cameraStreamRef = useRef(null);\n\n  // Start scrolling immediately after brief loading\n  useEffect(() => {\n    const fastStartTimer = setTimeout(() => {\n      setIsLoading(false);\n      setIsInitialized(true);\n    }, 2000);\n    \n    return () => clearTimeout(fastStartTimer);\n  }, []);\n\n  // Инициализация и управление камерой\n  useEffect(() => {\n    if (!cameraOn) {\n      // Выключаем камеру\n      if (videoRef.current && videoRef.current.srcObject) {\n        const tracks = videoRef.current.srcObject.getTracks();\n        tracks.forEach(track => track.stop());\n        videoRef.current.srcObject = null;\n        cameraStreamRef.current = null;\n      }\n      return;\n    }\n\n    const constraints = {\n      video: { \n        facingMode: 'user',\n        width: window.innerWidth,\n        height: window.innerHeight\n      }\n    };\n\n    // Функция для запуска камеры\n    const startCamera = async () => {\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia(constraints);\n        cameraStreamRef.current = stream;\n        \n        if (videoRef.current) {\n          // Подключаем поток к видео элементу\n          videoRef.current.srcObject = stream;\n          \n          // Важно! Нужно дождаться, пока видео будет готово к воспроизведению\n          videoRef.current.onloadedmetadata = () => {\n            // Теперь можно запускать воспроизведение\n            if (videoRef.current) {\n              videoRef.current.play()\n                .catch(e => console.error('Ошибка воспроизведения:', e));\n            }\n          };\n\n          // Если видео остановилось, пытаемся перезапустить\n          videoRef.current.onpause = () => {\n            if (cameraOn && videoRef.current) {\n              videoRef.current.play()\n                .catch(e => console.error('Ошибка перезапуска:', e));\n            }\n          };\n        }\n      } catch (err) {\n        console.error('Ошибка запуска камеры:', err);\n      }\n    };\n\n    // Запускаем камеру только если она включена\n    startCamera();\n\n    // Следим за видимостью страницы\n    const handleVisibilityChange = () => {\n      if (document.visibilityState === 'visible' && cameraOn) {\n        startCamera();\n      }\n    };\n\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n\n    // При размонтировании компонента или выключении камеры\n    return () => {\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n      \n      // Останавливаем все треки камеры\n      if (cameraStreamRef.current) {\n        const tracks = cameraStreamRef.current.getTracks();\n        tracks.forEach(track => track.stop());\n        cameraStreamRef.current = null;\n      }\n      if (videoRef.current && videoRef.current.srcObject) {\n        const tracks = videoRef.current.srcObject.getTracks();\n        tracks.forEach(track => track.stop());\n        videoRef.current.srcObject = null;\n      }\n    };\n  }, [cameraOn]);\n\n  // Initialize audio\n  useEffect(() => {\n    try {\n      audioRef.current = new Audio();\n      \n      const handleAudioEnded = () => {\n        setIsAudioPlaying(false);\n      };\n      \n      audioRef.current.addEventListener('ended', handleAudioEnded);\n      \n      const handleAudioError = (e) => {\n        console.error(\"Audio error:\", e);\n        audioErrorCount.current += 1;\n        \n        if (audioErrorCount.current >= 3) {\n          setAudioDisabled(true);\n        }\n        \n        setIsAudioPlaying(false);\n      };\n      \n      audioRef.current.addEventListener('error', handleAudioError);\n      \n      return () => {\n        if (audioRef.current) {\n          audioRef.current.pause();\n          audioRef.current.removeEventListener('ended', handleAudioEnded);\n          audioRef.current.removeEventListener('error', handleAudioError);\n        }\n      };\n    } catch (error) {\n      console.error(\"Audio initialization error:\", error);\n      setAudioDisabled(true);\n      return () => {};\n    }\n  }, []);\n\n  // Останавливаем аудио при выключении звука\n  useEffect(() => {\n    if (!soundOn && audioRef.current && !audioRef.current.paused) {\n      audioRef.current.pause();\n      setIsAudioPlaying(false);\n    }\n  }, [soundOn]);\n\n  // Set up animation and center detection\n  useEffect(() => {\n    if (!isInitialized) return;\n    \n    const checkCenterPrompt = () => {\n      if (isAudioPlaying || audioDisabled || !soundOn) return;\n\n      try {\n        const windowCenter = window.innerHeight / 2;\n        const textSteps = document.querySelectorAll('.text-step');\n        if (!textSteps || !textSteps.length) return;\n        \n        let closestToCenter = null;\n        let smallestDistance = Infinity;\n        \n        textSteps.forEach((step) => {\n          try {\n            const rect = step.getBoundingClientRect();\n            const stepCenter = rect.top + rect.height / 2;\n            const distance = Math.abs(stepCenter - windowCenter);\n            \n            if (distance < smallestDistance) {\n              smallestDistance = distance;\n              closestToCenter = step;\n            }\n          } catch (error) {\n            // Silent catch for any getBoundingClientRect errors\n          }\n        });\n        \n        if (closestToCenter && smallestDistance < 50) {\n          const promptInCenter = closestToCenter.textContent;\n          \n          if (promptInCenter && promptInCenter !== currentPromptInCenter) {\n            setCurrentPromptInCenter(promptInCenter);\n            \n            if (!audioDisabled) {\n              const audioNumber = AUDIO_MAPPING[promptInCenter];\n              if (audioNumber) {\n                playAudio(audioNumber);\n              }\n            }\n          }\n        }\n      } catch (error) {\n        console.error(\"Error in checkCenterPrompt:\", error);\n      }\n    };\n    \n    const animate = () => {\n      try {\n        setOffset((prev) => prev - SCROLL_SPEED);\n        \n        if (!audioDisabled && soundOn) {\n          checkCenterPrompt();\n        }\n        \n        animationRef.current = requestAnimationFrame(animate);\n      } catch (error) {\n        console.error(\"Animation error:\", error);\n        animationRef.current = requestAnimationFrame(animate);\n      }\n    };\n    \n    animationRef.current = requestAnimationFrame(animate);\n    \n    return () => {\n      if (animationRef.current) {\n        cancelAnimationFrame(animationRef.current);\n      }\n    };\n  }, [currentPromptInCenter, isAudioPlaying, isInitialized, audioDisabled, soundOn]);\n\n  const playAudio = (audioNumber) => {\n    if (!audioRef.current || audioDisabled || !soundOn) return;\n\n    try {\n      setIsAudioPlaying(true);\n\n      const audioSrc = `${process.env.PUBLIC_URL}/audio/audio_${\n        String(audioNumber).padStart(2, \"0\")\n      }.mp3`;\n\n      if (!audioRef.current.paused) audioRef.current.pause();\n      audioRef.current.src = audioSrc;\n      \n      const safetyTimeout = setTimeout(() => {\n        setIsAudioPlaying(false);\n      }, 10000);\n      \n      audioRef.current.play()\n        .then(() => {\n          clearTimeout(safetyTimeout);\n        })\n        .catch((error) => {\n          console.error(\"Audio playback error:\", error);\n          clearTimeout(safetyTimeout);\n          setIsAudioPlaying(false);\n          \n          audioErrorCount.current += 1;\n          if (audioErrorCount.current >= 3) {\n            setAudioDisabled(true);\n          }\n        });\n    } catch (error) {\n      console.error(\"Error playing audio:\", error);\n      setIsAudioPlaying(false);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"text-container loading\">\n        <Loader \n          text=\"text\" \n          charInterval={50}\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"text-container\">\n      {cameraOn && (\n        <video\n          ref={videoRef}\n          autoPlay\n          playsInline\n          muted\n          className=\"video-bg\"\n        />\n      )}\n\n      <div\n        ref={textWrapperRef}\n        className=\"text-wrapper\"\n        style={{ transform: `translateX(-50%) translateY(${-offset}px)` }}\n      >\n        {prompts.map((prompt, idx) => (\n          <div \n            key={idx} \n            className=\"text-step\"\n          >\n            {prompt}\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nexport default Text;\n"],"names":["AUDIO_MAPPING","_ref","cameraOn","soundOn","toggleCamera","toggleSound","offset","setOffset","useState","window","innerHeight","currentPromptInCenter","setCurrentPromptInCenter","isAudioPlaying","setIsAudioPlaying","isInitialized","setIsInitialized","isLoading","setIsLoading","audioDisabled","setAudioDisabled","audioRef","useRef","videoRef","animationRef","textWrapperRef","audioErrorCount","cameraStreamRef","useEffect","fastStartTimer","setTimeout","clearTimeout","current","srcObject","getTracks","forEach","track","stop","constraints","video","facingMode","width","innerWidth","height","startCamera","async","stream","navigator","mediaDevices","getUserMedia","onloadedmetadata","play","catch","e","console","error","onpause","err","handleVisibilityChange","document","visibilityState","addEventListener","removeEventListener","Audio","handleAudioEnded","handleAudioError","pause","paused","animate","prev","checkCenterPrompt","windowCenter","textSteps","querySelectorAll","length","closestToCenter","smallestDistance","Infinity","step","rect","getBoundingClientRect","stepCenter","top","distance","Math","abs","promptInCenter","textContent","audioNumber","playAudio","requestAnimationFrame","cancelAnimationFrame","audioSrc","String","padStart","src","safetyTimeout","then","_jsx","className","children","Loader","text","charInterval","_jsxs","ref","autoPlay","playsInline","muted","style","transform","prompts","map","prompt","idx"],"sourceRoot":""}